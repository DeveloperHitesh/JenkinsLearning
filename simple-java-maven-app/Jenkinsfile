pipeline {
    agent any

    tools {
        maven 'maven'
    }

    parameters {
        // 1Ô∏è‚É£ STRING
        string(name: 'APP_VERSION', defaultValue: '1.0.0', description: 'Application Version')

        // 2Ô∏è‚É£ CHOICE (Dropdown)
        choice(name: 'ENV', choices: ['dev', 'qa', 'prod'], description: 'Deployment Environment')

        // 3Ô∏è‚É£ BOOLEAN (Checkbox)
        booleanParam(name: 'RUN_TESTS', defaultValue: true, description: 'Run Test Cases?')

        // 4Ô∏è‚É£ PASSWORD (Hidden text)
        password(name: 'SECRET_TOKEN', defaultValue: '', description: 'API/ACCESS Token')

        // 5Ô∏è‚É£ TEXT (Multiline)
        text(name: 'RELEASE_NOTES', defaultValue: 'Enter release notes here...', description: 'Release description')

        // 6Ô∏è‚É£ FILE (Upload file)
        file(name: 'CONFIG_FILE', description: 'Upload config file (JSON/YAML)')

        // 7Ô∏è‚É£ CREDENTIALS (Pick from Jenkins Credentials)
        credentials(name: 'DEPLOY_CRED', description: 'Select deployment credentials', 
            credentialType: 'com.cloudbees.plugins.credentials.common.StandardUsernamePasswordCredentials')

        // 8Ô∏è‚É£ RUN PARAMETER (Pick another pipeline build)
        //run(name: 'BASE_BUILD', job: 'java-fast-build')
    }

    stages {

        stage('Show Parameter Values') {
            steps {
                echo "Selected App Version   : ${APP_VERSION}"
                echo "Environment            : ${ENV}"
                echo "Run Tests              : ${RUN_TESTS}"
                echo "Deployment Credential  : ${DEPLOY_CRED}"
                echo "Secret Token (Masked)  : ${SECRET_TOKEN}"
                //echo "Selected Base Build    : ${BASE_BUILD}"

                echo """
================ RELEASE NOTES ================
${RELEASE_NOTES}
==============================================
                """
            }
        }

        stage('Checkout Code') {
            steps {
                git branch: 'master', url: 'https://github.com/jenkins-docs/simple-java-maven-app.git'
            }
        }

        stage('Build App') {
            steps {
                sh 'mvn clean install -DskipTests'
            }
        }

        stage('Run Tests') {
            when {
                expression { RUN_TESTS == true }
            }
            steps {
                echo "Running tests..."
                sh 'mvn test'
            }
        }

        stage('Upload Config File') {
            when {
                expression { fileExists(CONFIG_FILE) }
            }
            steps {
                echo "Uploaded file stored at: ${CONFIG_FILE}"
                sh "cp '${CONFIG_FILE}' ."
            }
        }

        stage('Archive Artifact') {
            steps {
                archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true
            }
        }

        stage('Deploy') {
            when {
                expression { ENV == 'prod' }
            }
            steps {
                echo "Deploying version ${APP_VERSION} to ${ENV}"
                echo "Using credentials: ${DEPLOY_CRED}"
                sh 'echo "Simulating deployment..."'
            }
        }

    }

    post {
        success {
            echo "üéâ Pipeline completed successfully!"
        }
        failure {
            echo "‚ùå Pipeline failed!"
        }
        always {
            echo "Cleaning workspace..."
            cleanWs()
        }
    }
}
